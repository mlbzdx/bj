# 自定义指令部分知识

## 1.复习了静态与动态资源的路径导入问题

## 2.添加了图片视频等网络请求渲染前的加载显示效果

## 3.自定义指令

什么是指令？我们已经学过了那些指令？为什么要自定义指令？怎样自定义指令？

指令是vue实例中的配置，可以给组件和Dom元素使用，以标签属性类的方式使用，不同的指令有不同的功能。我们目前已经学过v-bind，v-for，v-slot，v-if，v-show等指令。

前面我们已经学习过了vue的部分[内置指令](https://vuejs.bootcss.com/api/#%E6%8C%87%E4%BB%A4)，可以在官方文档中中查询。

关于vue的[自定义指令](https://vuejs.bootcss.com/guide/custom-directive.html)部分，也可参见官方文档

自定义指令定义可以分为全局和局部两种情况。

### 指令的定义

#### 全局定义

##### 1.在main.js中定义

```main.js
//全局定义需要调用vue构造函数的静态方法directice
//构造函数中传入两个参数，第一个参数是一个字符串，为自定义指令的名称，第二个参数是一个对象，里面是指令的相关配置
import Vue from "vue";
Vue.directive("mydirective1",{
    //相关的配置
});
Vue.directive("mydirective2",{
    //相关的配置
})
```

##### 2.在我的组件中使用

```mycomponent.vue
<template>
<!--某个自定义组件 -->
    <!-- 通过v-自定义指令名 以组件属性或标签属性的方式使用，属性值部分传入js表达式-->
	<mycomponent v-mydirective1="js表达式"></mycomponent>
	<div v-mydirective2="js表达式"></div>
</template>
```

#### 组件中的局部定义与使用

```mycomponent.vue
<template>
<!--某个自定义组件 -->
    <!-- 通过v-自定义指令名 以组件属性或标签属性的方式使用，属性值部分传入js表达式-->
		<mycomponent v-mydirective1="js表达式"></mycomponent>
		<div v-mydirective2="js表达式"></div>
</template>

<script>
export default {
	//类似于组件的注册，这里需要配置组件导出的directive属性,directive的值为一个对象，该对象为若干个自定义指令的对象构成。
	directive : {
		mydirective1 : {
			//指令配置
		},
		mydirective2 : {
			//指令配置
		},
	}
}
</script>
```

### 指令的配置

vue 会在指令配置时提供一些[钩子函数（下面是指令配置中常用的钩子函数，更多参考官方文档）](https://vuejs.bootcss.com/guide/custom-directive.html#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0)，在适当的时机，vue会调用钩子函数并传入适当的参数,以便开发者完成自己想做的事情。

指令配置中提供的所有钩子函数中的参数几乎相同，其中前两个参数`el`和`binding`比较重要

```direcive.js
//导出指令的配置对象
export default {
	bind(el,binding){
	//只调用一次，指令第一次绑定到元素的时调用，在这里可以进行一次性的初始化设置
	//el是被绑定元素对应的真实DOM
	//binding 是一个对象，描述了指令中提供的信息
	},
	inserted(){
	// 被绑定元素插入父节点时调用
	},
	update(){
	// 所在组件的VNode更新时调用
	}
}
```

> #### 补充：binding对象
>
> <img src="http://mdrs.yuanjin.tech/img/20210104174229.png" alt="image-20210104174229660" style="zoom:50%;" />
>
> [查看更多binding对象的属性](https://cn.vuejs.org/v2/guide/custom-directive.html#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0)

##### 配置简化

比较多的时候，在配置自定义指令时，我们都会配置两个钩子函数

```js
{
  bind(el, bingding){
    
  },
  update(el, bingding){
    
  }
}
```

这样，在元素绑定和更新时，都能运行到钩子函数

如果这两个钩子函数实现的功能相同，可以直接把指令配置简化为一个单独的函数：

```js
function(el, bingding){
  // 该函数会被同时设置到bind和update中
}
```

